# Crystal-Net-Flat-Bands

README

Readme file for code associated with the paper "Crystal Net Catalog of Model Flat Band Materials" by P. M. Neves et al., published 2024 in npj Computational Materials.


CONTACT

If you run into code issues, try contacting Paul M. Neves, who wrote the code, current (January 2024) email pmneves@mit.edu. Otherwise email Joseph P. Checkelsky, checkelsky@mit.edu


FILE DESCRIPTIONS AND INFO
 - main_search.py is the main search file. You need to add your own Materials Project API key on line 146. The main functions to run in the main code section at the bottom are: "refresh_MP_data" "run_all_calcs" "continue_calc" "recalc_systre_keys" "collect_systre_keys". refresh_MP_data must be run first to download and save all the materials from the materials project. The search parameters are specified by changing properties of the paramObj object that is passed to the run_all_calcs function. Running the run_all_calcs function will produce a large number of files and folders in a subfolder of the outputs folder. The name of this subdirectory (a datetime string) is the argument passed to continue_calc, recalc_systre_keys, and collect_systre_keys to continue an interrupted calculation, recalculate failed systre keys of a calculation, or collect the systre keys into a separate file, respectively.

 - refresh_MP_data.py downloads the material information from the materials project. This requires the materials project key from line 146 on main_search.py to be defined. This is run from the command line. Allowed commands are "python3 refresh_MP_data _" where the underscore is R, C, B, E, or D, see file for descriptions. R will remove the downloaded results, C will check the downloaded results and redownload any missed ones. D will save metadata that is used in generating the spreadsheet in collect_and_output.py

 - collect_and_output.py collects together all the search results and generates a spreadsheet and various statistics. You will need to change the names of the folders on lines 161-170 or 177-181 to the ones you want to consider, as well as the max_dists and decay_rates lists. If you use a different set of chi and decays, you will also need to change the definitions on lines 204-214, 234-257, 317-349, 805-823, 858-867, and 992-1001. Set refresh_data to true to recollect the data for the spreadsheet etc, and consider_decay is a flag for switching between including or excluding the results with decaying hopping strength. Further flags are on line 418 to display statistics on nets (484 to save the key list), 804 to display some filtered results, 829 to save a spreadsheet, 873 to save a spreadsheet with the lattice invariants (915-916 to either recalculate and save or reload the lattice IDs) - this requires you to run get_graph_invariants.py first, 1007 to make pie charts (1016 to download information from the materials project or load), 1116 to make bar charts, and 1266 to make latex files for tables about the search results.

 - get_graph_invariants.py finds graph invariants in the search results. This must be run to generate the graph invariants for sorting the graphs. Options are included on lines 537-540. Set recalc_invariants to true to recalculate lattice invariants. Set reclean_invariants to true to search through the invariants and find unique ones. Set consider_decay to true to work on the list including decay that is generated by collect_and_output.py. Set do_systre to true to calculate the lattice invariants on the lattices successfully classified by systre, as a check on how well the lattice invariants did. Note that you have to run collect_and_output.py first to create the unique_FBs object and save the unique_results pickle file.

 - Systre-exp-fix2.jar is a java file to run Systre. Newer versions can be found at http://gavrog.org


INSTRUCTIONS
1. Insert your API key into main_search.py
2. Run refresh_MP_data in main_search.py to download the materials project materials to your computer.
3. Run refresh_MP_data C then refresh_MP_data D on the command line to confirm no materials were missing. You may need to run refresh_MP_data C multiple times before all materials are downloaded successfully.
4. Run run_all_calcs in main_search.py with the desired search settings to calculate the bandstructures and systre keys for all the materials. Then run collect_systre_keys in main_search.py to collect the keys into a separate file.
5. Run collect_and_output.py with refresh_data set to true and the ts_list updated. You may also need to update other variable names if using a different set of chi than [1.02, 1.05, 1.1, 1.2, 1.4]. All optional segments below line 418 can be set to false for now.
6. Run get_graph_invariants with recalc_invariants and reclean_invariants true (and do_systre false) to recalculate lattice invariants on your search results.
7. Run collect_and_output.py with any other options true. Most useful is line 873 which makes the excel sheet with the named lattice invariants.


DEPENDENCIES

You need python3, as well as the python packages:
-scipy
-numpy
-pymatgen
-matplotlib
-pandas
-colorcet (for coloring pie and bar charts)
-mendeleev (for information on elements)
-pythtb (for tight binding)
You will also need java installed to run systre
